<!DOCTYPE html>
<html lang="ko" xmlns:th="http://thymeleaf.org">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title th:text="${title}"></title>
  <meta name="format-detection" content="telephone=no" />
  <meta name="description" content="킹스라운지" />
  <meta name="keywords" content="킹스라운지" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="" />
  <meta property="og:title" content="킹스라운지" />
  <meta property="og:description" content="킹스라운지" />
  <link th:rel="stylesheet" th:href="@{/static/css/play/common.css}">
  <link href='http://fonts.googleapis.com/css?family=Josefin+Sans&subset=latin,latin-ext' rel='stylesheet' type='text/css'>
  <script src="//code.jquery.com/jquery-3.4.1.min.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script th:src="@{/static/js/common.js}"></script>
  <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>

    <script th:inline="javascript">

      /*<![CDATA[*/

         // ===== room / mode =====
        var room = /*[[${room}]]*/ null;
        var WS_ENDPOINT = /*[[@{/ws}]]*/ "/ws";

        // URL 파라미터로 모드 결정
        // 전광판: ?room=ABCD&display=1
        // 컨트롤: ?room=ABCD&ctrl=1
        var qs = new URLSearchParams(window.location.search);
        var isDisplay = qs.get("display") === "1";
        var syncEnabled = !!room;

        // ✅ ctrl 파라미터 없더라도 room 있고 display 아니면 컨트롤로 본다
        var isCtrl = (qs.get("ctrl") === "1") || (syncEnabled && !isDisplay);

        // ===== STOMP =====
        var stompClient = null;

        function connectStomp() {
          if (!syncEnabled) return;

          var socket = new SockJS(WS_ENDPOINT);
          stompClient = Stomp.over(socket);
          stompClient.debug = null; // 콘솔 로그 끄기

          stompClient.connect({}, function () {
            // room 토픽 구독
            stompClient.subscribe("/topic/rooms/" + room, function (msg) {
              // ✅ 컨트롤 화면은 구독 메시지 적용 금지(에코 방지)
              if (isCtrl) return;

              try {
                var data = JSON.parse(msg.body);
                applyRemoteState(data);
              } catch (e) {
                console.error("bad ws msg", e);
              }
            });

            // 접속 직후 현재 상태 1번 요청(전광판이 새로 켜져도 즉시 동기화)
            stompClient.send("/app/rooms/" + room + "/sync", {}, "");
          }, function (err) {
            console.error("stomp connect fail", err);
          });
        }

        // 컨트롤 화면이 현재 상태를 방송
        function broadcastState(statusText) {
          if (!syncEnabled) return;
          if (!stompClient || !stompClient.connected) return;

          // NEXT BREAK 계산
          //breakTimeSum(); // breakTime 갱신됨

          // AVG STACK 계산
          var avg = Math.floor(avgStackTotal / player);
          if (!isFinite(avg)) avg = 0;

          var payload = {
            blindLvl: blindLvl,
            remainingSec: time,
            player: player,
            totalPlayer: totalPlayer,
            status: statusText || "RUNNING",

            nextBreakSec: breakTime,
            avgStack: avg,
            totalRunningSec: totalRunTime
          };

          stompClient.send("/app/rooms/" + room + "/state", {}, JSON.stringify(payload));
        }

        // 전광판이 서버 상태를 받아 적용
        function applyRemoteState(s) {
            if (!isDisplay) return;

          // blindLvl/time/player/totalPlayer 갱신
          if (typeof s.blindLvl === "number") blindLvl = s.blindLvl;
          if (typeof s.remainingSec === "number") time = s.remainingSec;
          if (typeof s.player === "number") player = s.player;
          if (typeof s.totalPlayer === "number") totalPlayer = s.totalPlayer;
          if (typeof s.nextBreakSec === "number") {
            renderHMS("#breakTime", s.nextBreakSec);
          }

          if (typeof s.avgStack === "number") {
            $("#avgStackTotal").text(addComma(s.avgStack));
          }

          if (typeof s.totalRunningSec === "number") {
            renderHMS("#totalRunTime", s.totalRunningSec);
          }
          // 화면 반영(기존 함수 재사용)
          renderByBlindLvl();
          renderTime(time);
          $("#nowPlayer").text(player);
          $("#totalPlayer").text(totalPlayer);

          // 전광판은 로컬 타이머 절대 돌리지 않음
          if (isDisplay) {
            clearInterval(timer);
            starFlag = true;
          }
        }

        // blindLvl 기준으로 화면 갱신(기존 nextLvl 로직을 “표시 전용”으로 분리)
        function renderByBlindLvl() {
          if (!isDisplay) {
            breakTimeSum();
          }

          if (blindList[blindLvl] && blindList[blindLvl].breakYn == 'Y') {
            $("#lvl").text("BREAK");
            $("#smallBlind").text("0");
            $("#bigBlind").text("0");
            $("#ante").text("0");

            if (blindList[blindLvl + 1]) {
              $("#nextLvlSmallBlind").text(blindList[blindLvl + 1].smallBlind);
              $("#nextLvlBigBlind").text(blindList[blindLvl + 1].bigBlind);
              $("#nextLvlAnte").text(blindList[blindLvl + 1].ante);
            }
          } else if (blindList[blindLvl]) {
            $("#lvl").text(blindList[blindLvl].lvl);
            $("#smallBlind").text(blindList[blindLvl].smallBlind);
            $("#bigBlind").text(blindList[blindLvl].bigBlind);
            $("#ante").text(blindList[blindLvl].ante);

            if (blindList[blindLvl + 1]) {
              if (blindList[blindLvl + 1].breakYn == 'Y') {
                $("#nextLvlSmallBlind").text("0");
                $("#nextLvlBigBlind").text("0");
                $("#nextLvlAnte").text("0");
              } else {
                $("#nextLvlSmallBlind").text(blindList[blindLvl + 1].smallBlind);
                $("#nextLvlBigBlind").text(blindList[blindLvl + 1].bigBlind);
                $("#nextLvlAnte").text(blindList[blindLvl + 1].ante);
              }
            }
          }
        }

        function renderTime(secLeft) {
          var m = Math.floor(secLeft / 60);
          var s = secLeft % 60;
          if (m < 0) m = 0;
          if (s < 0) s = 0;

          var tm = (m < 10 ? "0" : "") + m;
          var ts = (s < 10 ? "0" : "") + s;

          document.getElementById("timeMi").innerHTML = tm;
          document.getElementById("timeSs").innerHTML = ts;
        }


          (function () {
            const BASE_W = 1536;
            const BASE_H = 864;

            function applyScale() {
              const vw = window.innerWidth;
              const vh = window.innerHeight;

              const scale = Math.min(vw / BASE_W, vh / BASE_H);

              const wrap = document.querySelector(".wrap");
              if (!wrap) return;

              // 스케일
              wrap.style.transform = `scale(${scale})`;
              wrap.style.transformOrigin = "top left";

              // ✅ 가운데 정렬(레터박스)
              const scaledW = BASE_W * scale;
              const scaledH = BASE_H * scale;
              const offsetX = Math.max(0, (vw - scaledW) / 2);
              const offsetY = Math.max(0, (vh - scaledH) / 2);

              wrap.style.position = "absolute";
              wrap.style.left = offsetX + "px";
              wrap.style.top = offsetY + "px";
            }

            window.addEventListener("load", applyScale);
            window.addEventListener("resize", applyScale);
          })();

      document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".rank1 dl dd, .rank1 dl dt").forEach((el) => {
          if (el.textContent.trim().length > 15) { // 글자 길이 기준 조절 가능
            el.classList.add("small-font");
          }
        });
      });

      var time = 0;
      var breakTime = 0;
      var totalRunTime = 0;
      var starFlag = true;
      var blindList = /*[[${blindList}]]*/;
      var blindLvl = 0;
      var timer;
      var player = 0;
      var totalPlayer = 0;
      var startStack = /*[[${gameInfo.startStackInt}]]*/;
      var rebuyStack = /*[[${gameInfo.rebuyStackInt}]]*/;
      var startTime = /*[[${gameInfo.startTime}]]*/;
      var avgStackTotal = 0;
      const itemsPerPage = 8;
      let currentPage = 1;
      let direction = 1; // 1: forward, -1: backward
      let autoPaging;

      $(document).ready(function(){
            // WS 연결
            connectStomp();

            // 전광판 모드면 조작 UI 숨김 + 로컬 타이머/이벤트 안 붙임
            if (isDisplay) {
              $(".bottom").hide();
              $("#stopbtn").hide();

              // 표시용 초기 렌더
              renderByBlindLvl();
              renderTime(time);

              return;
            }


          paginateRank2();
          autoPaging = setInterval(changePageAuto, 10000);
          breakTimeSum();

          $("#lvl").text(blindList[blindLvl].lvl);
          $("#smallBlind").text(blindList[blindLvl].smallBlind);
          $("#bigBlind").text(blindList[blindLvl].bigBlind);
          $("#ante").text(blindList[blindLvl].ante);

          if(blindList[blindLvl+1] != null){
              $("#nextLvlSmallBlind").text(blindList[blindLvl+1].smallBlind);
              $("#nextLvlBigBlind").text(blindList[blindLvl+1].bigBlind);
              $("#nextLvlAnte").text(blindList[blindLvl+1].ante);
          }

          min = Math.floor(blindList[0].time/60);
          hour = Math.floor(min/60);
          sec = blindList[0].time%60;

          var tm = min;
          var ts = sec;

          if(tm < 10){
              tm = "0" + min;
          }

          if(ts < 10){
              ts = "0" + sec;
          }

          document.getElementById("timeMi").innerHTML = tm;
          document.getElementById("timeSs").innerHTML = ts;

          time = blindList[blindLvl].time;

          b_min = Math.floor(breakTime/60%60);
          b_hour = Math.floor(breakTime/60/60);
          b_sec = breakTime%60;

          var b_th = b_hour;
          var b_tm = b_min;
          var b_ts = b_sec;

          if(b_th < 10){
              b_th = "0" + b_hour;
          }

          if(b_tm < 10){
              b_tm = "0" + b_min;
          }

          if(b_ts < 10){
              b_ts = "0" + b_sec;
          }

          $("#breakTime").text(b_th + ":" + b_tm + ":" + b_ts);

          $("#pausebtn").click(function(){
                if (isCtrl) {
                    broadcastState("PAUSED");
                }

                if(time != 0){
                    clearInterval(timer);
                    starFlag = true;
                }
          });

          $("#stopbtn").click(function(){
              window.location.href = "/game";
          });

          $("#lvlUp").click(function(){
              blindLvl++;
              breakTimeSum();
              nextLvl();
          });

          $("#lvlDown").click(function(){
              if(blindLvl != 0){
                  blindLvl--;
                  breakTimeSum();
                  nextLvl();
              }
          });

          $("#playerPlus").click(function(){
              player++;

              $("#nowPlayer").text(player);
              avgTotal();
          });

          $("#playerMinus").click(function(){
              player--;

              $("#nowPlayer").text(player);
              avgTotal();
          });

          $("#rebuyPlus").click(function(){
              player++;
              totalPlayer++;

              avgStackTotal += rebuyStack;

              $("#nowPlayer").text(player);
              $("#totalPlayer").text(totalPlayer);

              avgTotal();
          });

          $("#rebuyMinus").click(function(){
              if(player != 0){
                  player--;
              }

              if(totalPlayer != 0){
                  totalPlayer--;
              }

              if(avgStackTotal != 0){
                  avgStackTotal -= rebuyStack;
              }

              $("#nowPlayer").text(player);
              $("#totalPlayer").text(totalPlayer);

              avgTotal();
          });

          $("#entryPlus").click(function(){
              player++;
              totalPlayer++;

              avgStackTotal += startStack;

              $("#nowPlayer").text(player);
              $("#totalPlayer").text(totalPlayer);

              avgTotal();
          });

          $("#entryMinus").click(function(){
              if(player != 0){
                  player--;
              }

              if(totalPlayer != 0){
                  totalPlayer--;
              }

              if(avgStackTotal != 0){
                  avgStackTotal -= startStack;
              }

              $("#nowPlayer").text(player);
              $("#totalPlayer").text(totalPlayer);

              avgTotal();
          });

          $("#timePlusBtn").click(function(){
              time = time + 60;
              breakTime = breakTime + 60;
              totalRunTime = totalRunTime - 60;

              min = Math.floor(time/60);
              hour = Math.floor(min/60);
              sec = time%60;
              min = min%60;

              var tm = min;
              var ts = sec;

              if(tm < 10){
                  tm = "0" + min;
              }

              if(ts < 10){
                  ts = "0" + sec;
              }

              document.getElementById("timeMi").innerHTML = tm;
              document.getElementById("timeSs").innerHTML = ts;

              b_min = Math.floor(breakTime/60%60);
              b_hour = Math.floor(breakTime/60/60);
              b_sec = breakTime%60;

              var b_th = b_hour;
              var b_tm = b_min;
              var b_ts = b_sec;

              if(b_th < 10){
                  b_th = "0" + b_hour;
              }

              if(b_tm < 10){
                  b_tm = "0" + b_min;
              }

              if(b_ts < 10){
                  b_ts = "0" + b_sec;
              }

              t_min = Math.floor(totalRunTime/60%60);
              t_hour = Math.floor(totalRunTime/60/60);
              t_sec = totalRunTime%60;

              var t_th = t_hour;
              var t_tm = t_min;
              var t_ts = t_sec;

              if(t_th < 10){
                  t_th = "0" + t_hour;
              }

              if(t_tm < 10){
                  t_tm = "0" + t_min;
              }

              if(t_ts < 10){
                  t_ts = "0" + t_sec;
              }

              $("#totalRunTime").text(t_th + ":" + t_tm + ":" + t_ts);
          });

          $("#timeMinusBtn").click(function(){
              if((time - 10) < 1){
                  time = 1;
              }else {
                  time = time - 60;
                  breakTime = breakTime - 60;
                  totalRunTime = totalRunTime + 60;
              }

              min = Math.floor(time/60);
              hour = Math.floor(min/60);
              sec = time%60;
              min = min%60;

              if(sec < 0){
                  blindLvl++;
                  breakTimeSum();
                  nextLvl();
                  return false;
              }{
                  var tm = min;
                  var ts = sec;

                  if(tm < 10){
                      tm = "0" + min;
                  }

                  if(ts < 10){
                      ts = "0" + sec;
                  }

                  document.getElementById("timeMi").innerHTML = tm;
                  document.getElementById("timeSs").innerHTML = ts;

                  b_min = Math.floor(breakTime/60%60);
                  b_hour = Math.floor(breakTime/60/60);
                  b_sec = breakTime%60;

                  var b_th = b_hour;
                  var b_tm = b_min;
                  var b_ts = b_sec;

                  if(b_th < 10){
                      b_th = "0" + b_hour;
                  }

                  if(b_tm < 10){
                      b_tm = "0" + b_min;
                  }

                  if(b_ts < 10){
                      b_ts = "0" + b_sec;
                  }

                  $("#breakTime").text(b_th + ":" + b_tm + ":" + b_ts);

                  t_min = Math.floor(totalRunTime/60%60);
                  t_hour = Math.floor(totalRunTime/60/60);
                  t_sec = totalRunTime%60;

                  var t_th = t_hour;
                  var t_tm = t_min;
                  var t_ts = t_sec;

                  if(t_th < 10){
                      t_th = "0" + t_hour;
                  }

                  if(t_tm < 10){
                      t_tm = "0" + t_min;
                  }

                  if(t_ts < 10){
                      t_ts = "0" + t_sec;
                  }

                  $("#totalRunTime").text(t_th + ":" + t_tm + ":" + t_ts);
              }
          });

          $("#refreshBtn").click(function(){
              clearInterval(timer);
              starFlag = true;

              location.reload();
          });

    });

    let timer2; // 전역에 선언

    const targetTime = new Date(startTime);

    //대회용 클락 스타트
    var autoFlag = true;
    function autoTimeGo(){
        $("#lvl").text("Starting In");

        if(autoFlag){
          updateCountdown(); // 최초 실행
          timer2 = setInterval(updateCountdown, 1000); // 1초마다 업데이트
          autoFlag = false;
        }

    }

    function updateCountdown() {
        const now = new Date();
        const diff = targetTime - now;

        const minutes = Math.floor(diff / 1000 / 60);
        const seconds = Math.floor((diff / 1000) % 60);

        const pad = num => String(num).padStart(2, '0');

        if (diff <= 0) {
            document.getElementById("timeMi").innerHTML = '00';
            document.getElementById("timeSs").innerHTML = '00';
            clearInterval(timer2);
            starFlag = true;
            $("#lvl").text("1");
            timeGo();

            return; // 중요! diff <= 0일 때 나머지 코드 실행 방지
        }

        document.getElementById("timeMi").innerHTML = pad(minutes);
        document.getElementById("timeSs").innerHTML = pad(seconds);
    }

    function timeGo(){
        if(starFlag){
            starFlag = false;

            if (isCtrl) {
                broadcastState("RUNNING"); // ✅ 시작 즉시 1번 방송
            }

            timer = setInterval(function(){

                time--;
                breakTime--;
                totalRunTime++;

                if (isCtrl) {
                    broadcastState("RUNNING");
                }

                min = Math.floor(time/60);
                hour = Math.floor(min/60);
                sec = time%60;
                min = min%60;

                var tm = min;
                var ts = sec;

                if(tm < 10){
                    tm = "0" + min;
                }

                if(ts < 10){
                    ts = "0" + sec;
                }

                document.getElementById("timeMi").innerHTML = tm;
                document.getElementById("timeSs").innerHTML = ts;

                if(blindList[blindLvl].breakYn == 'N'){
                    b_min = Math.floor(breakTime/60%60);
                    b_hour = Math.floor(breakTime/60/60);
                    b_sec = breakTime%60;

                    var b_th = b_hour;
                    var b_tm = b_min;
                    var b_ts = b_sec;

                    if(b_th < 10){
                        b_th = "0" + b_hour;
                    }

                    if(b_tm < 10){
                        b_tm = "0" + b_min;
                    }

                    if(b_ts < 10){
                        b_ts = "0" + b_sec;
                    }

                    $("#breakTime").text(b_th + ":" + b_tm + ":" + b_ts);
                } else {
                    $("#breakTime").text("00:00:00");
                }

                t_min = Math.floor(totalRunTime/60%60);
                t_hour = Math.floor(totalRunTime/60/60);
                t_sec = totalRunTime%60;

                var t_th = t_hour;
                var t_tm = t_min;
                var t_ts = t_sec;

                if(t_th < 10){
                    t_th = "0" + t_hour;
                }

                if(t_tm < 10){
                    t_tm = "0" + t_min;
                }

                if(t_ts < 10){
                    t_ts = "0" + t_sec;
                }

                $("#totalRunTime").text(t_th + ":" + t_tm + ":" + t_ts);

                if(time < 1){
                    blindLvl++;
                    nextLvl();
                }
            }, 1000);
        }
    }

    function breakTimeSum(){
        breakTime = 0;
        for(var i=blindLvl ; i<blindList.length ; i++){
            if(blindList[i].breakYn == 'N'){
                breakTime = breakTime + blindList[i].time;
            }else {
                break;
            }
        }
    }

    function avgTotal(){
        var avg = Math.floor(avgStackTotal / player);

        if (isNaN(avg)) {
            avg = 0;
        }

        if(!isFinite(avg)){
            avg = 0;
        }

        $("#avgStackTotal").text(addComma(avg));
    }

    function nextLvl(){
        breakTimeSum();

        if(blindList[blindLvl].breakYn == 'Y'){
            $("#lvl").text("BREAK");
            $("#smallBlind").text("0");
            $("#bigBlind").text("0");
            $("#ante").text("0");

            $("#nextLvlSmallBlind").text(blindList[blindLvl+1].smallBlind);
            $("#nextLvlBigBlind").text(blindList[blindLvl+1].bigBlind);
            $("#nextLvlAnte").text(blindList[blindLvl+1].ante);
        }else {
            $("#lvl").text(blindList[blindLvl].lvl);
            $("#smallBlind").text(blindList[blindLvl].smallBlind);
            $("#bigBlind").text(blindList[blindLvl].bigBlind);
            $("#ante").text(blindList[blindLvl].ante);

            if(blindList[blindLvl+1] != null){
                if(blindList[blindLvl+1].breakYn == 'Y'){
                    $("#nextLvlSmallBlind").text("0");
                    $("#nextLvlBigBlind").text("0");
                    $("#nextLvlAnte").text("0");
                }else {
                    $("#nextLvlSmallBlind").text(blindList[blindLvl+1].smallBlind);
                    $("#nextLvlBigBlind").text(blindList[blindLvl+1].bigBlind);
                    $("#nextLvlAnte").text(blindList[blindLvl+1].ante);
                }
            }
        }

        time = blindList[blindLvl].time;
        clearInterval(timer);
        starFlag = true;

        nextBeep();
        timeGo();

        if (isCtrl) {
            broadcastState("RUNNING");
        }
    }

    function nextBeep() {
        if (!isDisplay) {
            var snd = new Audio("../../static/sound/next_beep.mp3");
            snd.play();
        }
    }

    function getPrizeInfo(seq){
        var formData = new FormData();
        formData.append("seq", seq);

        $.ajax({
            type: "POST",
            url: "/game/getPrizeInfoAjax",
            data: formData,
            async : false,
            contentType : false,
            processData : false,
            success: function(response) {
                var rank1 = document.getElementById('rank1');
                var rank2 = document.getElementById('rank2');
                var startDl = "<dl>";
                var endDl = "</dl>";

                var rank1Html = "";
                if(response.prizeList1.length > 0){
                    for(var i=0 ; i<response.prizeList1.length ; i++){
                        rank1Html += startDl;
                        rank1Html += "<dt>";
                        if(response.prizeList1[i].rank == "1"){
                            rank1Html += "1st";
                        }else if(response.prizeList1[i].rank == "2"){
                            rank1Html += "2nd";
                        }else if(response.prizeList1[i].rank == "3"){
                            rank1Html += "3rd";
                        }
                        rank1Html += "</dt>";

                        //추가 시상이 있을시
                        if(response.prizeList1[i].addPrize != ''){
                            rank1Html += "<dd>" + response.prizeList1[i].prize.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",") + " + " + response.prizeList1[i].addPrize +  "</dd>";
                        }else {
                            rank1Html += "<dd>" + response.prizeList1[i].prize.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",") + "</dd>";
                        }

                        rank1Html += endDl;
                    }
                }else {
                  rank1Html = startDl + "<p style='font-size: xx-large;'>Prize shows on end of level 10</p>" + endDl;
                }
                rank1.innerHTML = rank1Html;

                var rank2Html = "";
                if(response.prizeList2.length > 0){
                    for(var i=0 ; i<response.prizeList2.length ; i++){
                        rank2Html += startDl;
                        rank2Html += "<dt>" + response.prizeList2[i].rank + "</dt>";

                        //추가 시상이 있을시
                        if(response.prizeList2[i].addPrize != ''){
                            rank2Html += "<dd>" + response.prizeList2[i].prize.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",") + " + " + response.prizeList2[i].addPrize +  "</dd>";
                        }else {
                            rank2Html += "<dd>" + response.prizeList2[i].prize.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ",") + "</dd>";
                        }

                        rank2Html += endDl;
                    }
                }

                rank2.innerHTML = rank2Html;

                $("#totalPrize").text(response.totalPrize.toString().replace(/\B(?<!\.\d*)(?=(\d{3})+(?!\d))/g, ","));

                // 초기 실행
                paginateRank2();
            },
            error: function(error) {
                alert("상금 조회 실패");
            }
        });
    }

    function paginateRank2() {
      const rank2 = document.getElementById('rank2');
      const items = rank2.querySelectorAll('dl');
      const totalPages = Math.ceil(items.length / itemsPerPage);

      // 전체 항목 페이드 아웃
      items.forEach(item => {
        item.classList.remove('show');
      });

      // 약간의 지연 후 페이드 인
      setTimeout(() => {
        items.forEach((item, index) => {
          const start = (currentPage - 1) * itemsPerPage;
          const end = currentPage * itemsPerPage;
          if (index >= start && index < end) {
            item.style.display = '';
            requestAnimationFrame(() => item.classList.add('show'));
          } else {
            item.style.display = 'none';
          }
        });
      }, 200);

    }

    function changePageAuto() {
      const rank2 = document.getElementById('rank2');
      const items = rank2.querySelectorAll('dl');
      const totalPages = Math.ceil(items.length / itemsPerPage);

      if(totalPages > 1){
        currentPage += direction;

        if (currentPage >= totalPages) {
          currentPage = totalPages;
          direction = -1;
        } else if (currentPage <= 1) {
          currentPage = 1;
          direction = 1;
        }

        paginateRank2();
      }
    }

    function renderHMS(selector, sec) {
      var h = Math.floor(sec / 3600);
      var m = Math.floor((sec % 3600) / 60);
      var s = sec % 60;

      var hh = (h < 10 ? "0" : "") + h;
      var mm = (m < 10 ? "0" : "") + m;
      var ss = (s < 10 ? "0" : "") + s;

      $(selector).text(hh + ":" + mm + ":" + ss);
    }


    /*]]>*/
</script>

</head>

<body>
  <div class="wrap">

    <div class="container">

      <div class="content">
        <div class="left">
          <h1><img th:src="@{${imgUrl}}" th:alt="${title}" style="width:100%;height:100%;"></h1>
          <div class="inner">
            <div class="rank1" id="rank1">
              <dl th:if="${!#lists.isEmpty(prizeList1)}" th:each="prizeList1:${prizeList1}">
                <dt th:text="${prizeList1.prizeTitle}"></dt>
                <dd th:text="|${#numbers.formatInteger(prizeList1.prize, 0, 'COMMA')}${#strings.isEmpty(prizeList1.addPrize) ? '' : ' + ' + prizeList1.addPrize}|"></dd>
              </dl>
              <dl th:if="${#lists.isEmpty(prizeList1)}">
                <p style="font-size: xx-large;">Prize shows on end of level 10</p>
              </dl>
            </div>

            <div class="rank2" id="rank2">
              <dl th:each="prizeList2:${prizeList2}">
                <dt th:text="${prizeList2.prizeTitle}"></dt>
                <dd th:text="|${#numbers.formatInteger(prizeList2.prize, 0, 'COMMA')}${#strings.isEmpty(prizeList2.addPrize) ? '' : ' + ' + prizeList2.addPrize}|"></dd>
              </dl>
            </div>

            <div class="total">
              <dl>
                <dt th:onclick="javascript:getPrizeInfo([[${gameInfo.seq}]]);">TOTAL PRIZE</dt>
                <dd id="totalPrize" th:text="${#numbers.formatInteger(totalPrize, 0, 'COMMA')}">
                </dd>
              </dl>
            </div>

          </div>

        </div>

        <div class="center">
          <h2><span th:text="${gameInfo.gameName}"></span></h2>
          <div class="inner">
            <dl class="info1">
              <dt>LEVEL</dt>
              <dd id="lvl">0</dd>
            </dl>
            <p class="info2">
              <span id="timeMi">00</span>:<span id="timeSs">00</span>
            </p>
            <div class="info3">
              <dl>
                <dt>BLINDS</dt>
                <dd><span id="smallBlind">0</span>/<span id="bigBlind">0</span></dd>
              </dl>
              <dl>
                <dt>ANTE</dt>
                <dd><span id="ante">100</span></dd>
              </dl>
            </div>
            <dl class="info4">
              <dt>NEXT LEVEL</dt>
              <dd>
                <span id="nextLvlSmallBlind">0</span>/<span id="nextLvlBigBlind">0</span>(<span id="nextLvlAnte">0</span>)
              </dd>
            </dl>
            <p style="text-align: center;">Copyright 2022 JTW Nal'K', All Right Reserved.</p>
          </div>
        </div>

        <div class="right">
          <div class="inner">
            <dl class="info1">
              <dt>NEXT BREAK</dt>
              <dd id="breakTime">00:00:00</dd>
            </dl>
            <dl class="info2">
              <dt>AVG.STACK</dt>
              <dd id="avgStackTotal">0</dd>
            </dl>
            <dl class="info2">
              <dt>Total Running Time</dt>
              <dd id="totalRunTime">00:00:00</dd>
            </dl>
            <dl class="info3">
              <dt>PLAYER</dt>
              <dd>
                <span id="nowPlayer">0</span>/<span id="totalPlayer">0</span>
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="bottom">
        <div class="inner">
          <dl>
            <dt>PLAYER</dt>
            <dd>
              <a class="up" href="#" id="playerPlus"><span>+</span></a>
              <a class="down" href="#" id="playerMinus"><span>-</span></a>
            </dd>
          </dl>
          <dl>
            <dt>ENTRY</dt>
            <dd>
              <a class="up" href="#" id="entryPlus"><span>+</span></a>
              <a class="down" href="#" id="entryMinus"><span>-</span></a>
            </dd>
          </dl>
          <dl>
            <dt>RE-Entry IN</dt>
            <dd>
              <a class="up" href="#" id="rebuyPlus"><span>+</span></a>
              <a class="down" href="#" id="rebuyMinus"><span>-</span></a>
            </dd>
          </dl>
          <dl>
            <dt>LEVEL</dt>
            <dd>
              <a class="up" href="#" id="lvlUp"><span>+</span></a>
              <a class="down" href="#" id="lvlDown"><span>-</span></a>
            </dd>
          </dl>
          <div class="btn">
            <a id="pausebtn" class="btn1" href="#">stop</a>
            <a id="startbtn" class="btn2" href="#" onclick="javascript:timeGo();">play</a>
            <a id="timePlusBtn" class="btn3" href="#">prev</a>
            <a id="timeMinusBtn" class="btn4" href="#">next</a>
            <a id="stopbtn" class="btn5" href="#" th:if="${gameInfo.regUserId == 'hunters'}">on/off</a>
            <a id="refreshBtn" class="btn6" href="#">refresh</a>
            <a id="startAutobtn" class="auto_btn2" href="#" onclick="javascript:autoTimeGo();">Auto Play</a>
          </div>

        </div>
      </div>
    </div>

  </div>
</body>
</html>
